{extend name="pc/common/_base" /}

{block name="title"}
<title>{$goodsInfo['title']}-{$website['title']}</title>
{/block}

{block name="footer"}
{/block}

{block name="main"}

<div class="container" id="root" style="width: 100%; height: 100%;padding: 0;margin: 0;box-sizing: border-box;display: flex;flex-direction: column;justify-content: center;align-items: center;">
    <div class="header-block" style="width: 100%;height: 64px;"></div>
    <div id="openseadragon-viewer" style="width: 100%; height: 100%;"></div>

    <div class="_controller_n3bcs_30">
        <span title="简介" class="anticon anticon-form" onclick="showToolbar()">
            <svg viewBox="64 64 896 896" focusable="false" data-icon="form" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"></path><path
                    d="M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"></path></svg>
        </span>
    </div>

    <div class="ant-dropdown-menu">
        <input type="hidden" value="0" id="isShowToolbar">
        <div class="ant-dropdown-menu-item flex-center" onclick="showToolbar()">
            <svg viewBox="64 64 896 896" focusable="false" data-icon="form" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                <path d="M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z"></path>
                <path d="M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 00-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1-360.5 359.7-45.7 1.1.7-46.4z"></path>
            </svg>
            <a style="margin-left: 10px;" id="showToolbarText">查看详情</a>
        </div>
    </div>

    {include file='pc/goods/tpl/view/toolbar'}
</div>

{/block}

{block name="script"}
<script type="text/javascript">

    require(["{$moduleAttachUrl}/static/components/openseadragon/openseadragon.min.js"], (OpenSeadragon) => {
        let prefixUrl = "{$moduleAttachUrl}/static/components/openseadragon/images/";

        let viewer = OpenSeadragon({
            id: "openseadragon-viewer",
            prefixUrl: prefixUrl,

            tileSources: {

                Image: {
                    xmlns: "http://schemas.microsoft.com/deepzoom/2009",
                    Url: "{$thumbOriginal['thumb']}",//包含0-N目录的文件夹所在位置 10,11,12,13,14,15,16,17,18
                    Overlap: "0",        // 切割图片时，每张图片（1024*1024）切割重合的像素。openseadragon根据这个属性自动调整图像重合的边距；
                    TileSize: "512",     // 每张切割下来的图像大小
                    Format: "jpg",      // 图片后缀格式

                    Size: {
                        Height: "{$thumbOriginal['height']}", // 原图的真实高度
                        Width: "{$thumbOriginal['width']}"// 原图真实宽度
                    },

                },

                defaultZoomLevel: 10, // 设置默认级别为 10
                minLevel: 10, // 最小值,
                maxLevel: 18, // 最大值
            },

            debugMode: false, // true或false   开启debug模式
            debugGridColor: ["#437AB2", "#1B9E77", "#D95F02", "#7570B3", "#E7298A", "#66A61E", "#E6AB02", "#A6761D", "#666666"], //debug颜色
            lendTime: 0,
            alwaysBlend: false, // 当图片缩小时，是否显示白色遮盖图片
            immediateRender: false, //初始化渲染，是否自动选择最佳分辨率图片显示，移动端最好开启
            opacity: 1, // 隐藏和显示，1显示，0全部隐藏
            preload: true,
            compositeOperation: "source-over",
            imageSmoothingEnabled: true,
            degrees: null,//图片旋转角度
            panHorizontal: true, //是否允许水平移动
            panVertical: true, //是否允许垂直移动
            visibilityRatio: .92, //0-1之间，0代表图片可完全拖出显示框，1代表图片一点也不可以拖出
            minZoomImageRatio: 0.8,// /0-1/最小缩放倍率，窗口的百分比
            maxZoomPixelRatio: 10,// //最大放大倍率，窗口的百分比
            iOSDevice: true, // 设置是否运行在ios设备上，以避免一些表现形式得不同，如果确认将在ios下运行，设置为true，不确认得时候忽略此属性
            showNavigationControl: false, //基础控件的展示与隐藏
            crossOriginPolicy: "Anonymous",  //设置为true 不允许使用跨域请求cors
            autoResize: true, //设置是否自动伸缩，若容器得宽度被放到或者缩小，则图片会自动重新使用
            preserveImageSizeOnResize: false, // 设置图像是否保留原图比例大小，以确保当容器被放大或者缩小时，图片被拉伸，当上一属性为true时起作用
            springStiffness: 4, //缩放过渡效果，，值越小，则动画越趋于柔和
            animationTime: .3, //放大或缩小动画过渡的时间，这个值越小，过渡快
            minPixelRatio: 0, // 值越大导航缩略图越大，显示不完整
            sequenceMode: false, //设置为true 代表加载的是一张图片，而非一个图片合集
            showSequenceControl: true, //显示向前向后按钮
            showNavigator: true, //是否显示导航缩略图
            navigatorRotate: true, //图像旋转时   导航地图同时旋转
            navigatorPosition: "BOTTOM_RIGHT", // 'TOP_LEFT'，'TOP_RIGHT'，'BOTTOM_LEFT'，'BOTTOM_RIGHT'或'ABSOLUTE'   ///导航所在位置 若为ABSOLUTE，可根据需求指定位置navigatorTop，navigatorLeft，  且会忽略下边两个属性若为其他，则会根据下边的属性或者导航的宽高确定导航的大小
            navigatorTop: 0,
            navigatorLeft: 0,
            navigatorHeight: 0, //指定后将会忽略上边两个属性
            navigatorWidth: 0, // 同上
            maxImageCacheCount: 128, // 最大缓存图片数量
        });

        // 监听缩放级别变化事件
        viewer.addHandler('zoom', function (event) {
            let zoomLevel = viewer.viewport.getZoom(true); // 获取当前缩放级别

            // console.log('zoomLevel', zoomLevel);

            // 根据缩放级别动态更新宽度和高度
            // let newWidth = 2048 * zoomLevel; // 5000 是初始宽度
            // let newHeight = 3191 * zoomLevel; // 3500 是初始高度

            // 更新 size 属性
            // viewer.world.getItemAt(0).source.dimensions = new OpenSeadragon.Point(newWidth, newHeight);
        });

        // 阻止默认右键菜单
        viewer.addHandler('canvas-contextmenu', function (event) {
            console.log(event);
            console.log('click:right');

            let left = event.position.x;
            let top = event.position.y;


            let isShowToolbarObj = $("#isShowToolbar");
            let isShowToolbar = parseInt(isShowToolbarObj.val());

            if (isShowToolbar === 1) {
                $("#showToolbarText").text('关闭详情');
            } else {
                $("#showToolbarText").text('查看详情');
            }

            $(".ant-dropdown-menu").show().css({
                'left': left - 20,
                'top': top + 45,
            });

            // 阻止事件继续传播
            event.preventDefault = true;
        });

        // 监听鼠标点击事件
        viewer.addHandler('canvas-click', function (event) {
            console.log('click:left');
            $(".ant-dropdown-menu").hide();
        });
    });

    function showToolbar() {
        $(".ant-dropdown-menu").hide();

        let isShowToolbarObj = $("#isShowToolbar");
        let isShowToolbar = parseInt(isShowToolbarObj.val());

        if (isShowToolbar === 1) {
            isShowToolbarObj.val(0);
            $('#viewToolbar').animate({'right': '-600'});
            $("#showToolbarText").text('关闭详情');
        } else {
            isShowToolbarObj.val(1);
            $("#showToolbarText").text('查看详情');
            $('#viewToolbar').animate({'right': '0'});
        }
    }
</script>

<script>
    (() => {
        try {
            // 获取传入的样式类型
            let bgStyle = decodeURIComponent(location.search).match(/bgStyle=(?:10|[1-9])/);

            // 获取根组件, 根据不同的类型设置不同的背景
            const oRoot = document.getElementById("root");

            // 判断是否存在样式类型
            if (bgStyle && bgStyle.length && oRoot) {
                // 切割样式类型
                let styleType = bgStyle[0].split("=")[1];

                switch (+styleType) {
                    // 纯色背景 ( #EFEFF4 )
                    case 1:
                        oRoot.style.background = "#EFEFF4";
                        break;
                    // 渐变背景 ( linear-gradient(to top,#232323,#989797 54%,#e4e4e4 92%,#8a8a8a) )
                    case 2:
                        oRoot.style.background = "linear-gradient(to top,#232323,#989797 54%,#e4e4e4 92%,#8a8a8a)";
                        break;
                    // 默认背景 ( linear-gradient(to top,#232323,#989797 54%,#e4e4e4 92%,#8a8a8a) )
                    default:
                        oRoot.style.background = "linear-gradient(to top,#232323,#989797 54%,#e4e4e4 92%,#8a8a8a)";
                        break;
                }
            } else if (oRoot) {
                // 判断地址栏是否传入白色背景
                let background = decodeURIComponent(location.href).match(/.*background=(#[\daAbBcCdDeEfF]+).*/);

                if (background && background[1]) {
                    oRoot.style.background = background[1];
                } else {
                    oRoot.style.background = "linear-gradient(to top,#232323,#989797 54%,#e4e4e4 92%,#8a8a8a)";
                }
            }
        } catch {
        }
    })();
</script>
{/block}

{block name="style"}
<link rel="stylesheet" href="{$moduleAttachUrl}/static/css/toolbar.css">
<style>
    html, body, .content {
        width: 100%;
        height: 100%;
        padding-top: 0;
    }

    ._controller_n3bcs_30 {
        position: absolute;
        width: auto;
        height: auto;
        top: 100px;
        right: 0;
        z-index: 999;
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: end;
    }

    ._controller_n3bcs_30 span {
        opacity: .6;
        transition: all .2s linear;
        display: block;
        padding: 20px 30px;
        cursor: pointer;
        fill: #fff;
        font-size: 28px;
        filter: drop-shadow(3px 3px 2px rgba(0, 0, 0, .7));
    }

    .ant-dropdown-menu {
        margin: 0;
        padding: 0;
        color: rgba(0, 0, 0, 0.88);
        font-size: 14px;
        position: absolute;
        z-index: 1050;

        width: 110px;
        background: #fff;
        --arrow-x: 0px;
        --arrow-y: -2px;
        inset: 254px auto auto 475px;
        box-sizing: border-box;
        display: none;
    }

    .ant-dropdown-menu .ant-dropdown-menu-item {
        line-height: 30px;
        cursor: pointer;
    }
</style>
{/block}