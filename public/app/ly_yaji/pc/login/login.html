{extend name="pc/common/_base" /}

{block name="title"}
<title>个人登录-{$website['title']}</title>
{/block}

{block name="style"}
<link rel="stylesheet" href="{$moduleAttachUrl}/static/css/login.css">
{/block}

{block name="nav"}
{include file='pc/login/_nav'}
{/block}

{block name="main"}
<section>
    <div class="login-main">

        <div class="container">

            <div class="login-form-box">

                <div class="login-title">用户登录</div>

                <div class="login-form">

                    <div class="input-box">
                        <div class="mobile-code"><i class="iconfont">&#xe632;</i></div>
                        <input type="text" name="username" placeholder="账号名/手机号" id="mobile">
                        <div class="help-block">账号名不能少于6位字符</div>
                        <div class="mobile-clear"><i class="iconfont">&#xe637;</i></div>
                    </div>

                    <div class="input-box">
                        <div class="mobile-code"><i class="iconfont">&#xe61b;</i></div>
                        <input type="password" name="password" placeholder="请输入密码" autocomplete="off">
                        <div class="help-block">请输入正确的密码(6~20位数)</div>
                        <div class="mobile-clear"><i class="iconfont">&#xe637;</i></div>
                    </div>

                    <a class="forgot-pwd" href="{:url('user/forget')}">忘记密码？</a>

                    <div class="btn-box">

                        <div class="inp"><input type="hidden" name="loginUrl" value="{:url('user/login')}"></div>
                        <div class="inp"><input type="hidden" name="backUrl" value="{$backUrl}"></div>

                        <div class="login-btn submit">立即登录</div>
                    </div>

                </div>

                <div class="login-footer">
                    <div class="pop-login-signup-box">
                        <a class="xa-showSignup" href="{:url('user/register')}">没有账号？<span>立即注册</span></a>
                    </div>
                </div>
            </div>


        </div>

    </div>
</section>
{/block}

{block name="script"}
<script>
    require(['jquery', 'tip', 'ajax'], ($) => {

        $(".submit").on("click", function () {
            let loginUrl = $(" input[ name='loginUrl' ] ").val();
            let backUrl = $(" input[ name='backUrl' ] ").val();
            let username = $(" input[ name='username' ] ").val();
            let password = $(" input[ name='password' ] ").val();

            if (username.length < 6) {
                tip.msgbox.err("账号名称不能少于6位字符");
                return false;
            }
            if (password === '') {
                tip.msgbox.err("请输入密码");
                return false;
            }
            if (password.length < 6) {
                tip.msgbox.err("请输入大于6位的密码");
                return false;
            }

            ajax.post(loginUrl, {username: username, password: password, backUrl: backUrl}, (json) => {
                tip.msgbox.suc("登录成功");
                setTimeout(() => {
                    jump(json.data.backUrl);
                }, 1500);
            });
        });

        $(" input[ name='password' ] ").on('input', function () {
            let username = $(this).val();

            if ((username.length > 20 || username.length < 6) && username) {
                $(this).parent().children('.help-block').show();
                $(this).parent().children('.mobile-clear').show();
            } else {
                $(this).parent().children('.help-block').hide();
                $(this).parent().children('.mobile-clear').hide();
            }
        });

        $(" input[ name='username' ] ").on('input', function () {
            let username = $(this).val();

            if (username.length < 6 && username) {
                $(this).parent().children('.help-block').show();
                $(this).parent().children('.mobile-clear').show();
            } else {
                $(this).parent().children('.help-block').hide();
                $(this).parent().children('.mobile-clear').hide();
            }
        });

        $(".mobile-clear").click(function () {
            let obj = $(this);
            obj.parent().children('input').val("");
            obj.parent().children('.help-block').hide();
            obj.parent().children('.mobile-clear').hide();
        });

        function jump(url) {
            location.href = url;
        }
    });
</script>
{/block}